<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>折叠功能独立测试</title>
    <style>
        .search-form {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
        }
        
        .search-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f5f5f5;
        }
        
        .search-row.hidden {
            display: none;
        }
        
        .toggle-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .toggle-btn:hover {
            background: #0056b3;
        }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>折叠功能独立测试</h1>
    
    <div class="debug-info">
        <h3>测试说明：</h3>
        <p>1. 点击"收起"按钮应该隐藏查询条件行</p>
        <p>2. 按钮文本应该变为"展开"</p>
        <p>3. 再次点击应该显示查询条件行</p>
        <p>4. 按钮文本应该变回"收起"</p>
    </div>
    
    <div class="search-form">
        <button id="search-toggle" class="toggle-btn">
            <span id="toggle-text">收起</span>
            <span id="toggle-icon">▲</span>
        </button>
        
        <div class="search-row">
            <label>商品名称: <input type="text" placeholder="请输入商品名称"></label>
            <label>商品编码: <input type="text" placeholder="请输入商品编码"></label>
        </div>
        
        <div class="search-row">
            <label>品牌: <input type="text" placeholder="请输入品牌"></label>
            <label>型号: <input type="text" placeholder="请输入型号"></label>
        </div>
        
        <div class="search-row">
            <label>创建人: <input type="text" placeholder="请输入创建人"></label>
            <label>创建时间: <input type="date"></label>
        </div>
        
        <div class="search-row">
            <label>状态: <select><option>全部</option><option>待处理</option></select></label>
            <label>优先级: <select><option>全部</option><option>高</option></select></label>
        </div>
    </div>
    
    <div class="debug-info">
        <h3>调试输出：</h3>
        <div id="debug-output"></div>
    </div>

    <script>
        // 调试输出函数
        function debugLog(message) {
            const output = document.getElementById('debug-output');
            const time = new Date().toLocaleTimeString();
            output.innerHTML += `<div>[${time}] ${message}</div>`;
            console.log(message);
        }
        
        // 折叠/展开查询表单
        function toggleSearchForm() {
            debugLog('toggleSearchForm 函数被调用');
            
            try {
                const searchRows = document.querySelectorAll('.search-row');
                const toggleText = document.getElementById('toggle-text');
                const toggleIcon = document.getElementById('toggle-icon');
                
                debugLog(`找到 ${searchRows.length} 个查询行`);
                debugLog(`当前按钮文本: "${toggleText ? toggleText.textContent : 'null'}"`);
                
                if (!searchRows.length) {
                    debugLog('错误: 没有找到查询行元素');
                    return;
                }
                
                if (!toggleText || !toggleIcon) {
                    debugLog('错误: 没有找到按钮文本或图标元素');
                    return;
                }
                
                // 检查当前状态
                const isCollapsed = searchRows[0].classList.contains('hidden');
                debugLog(`当前状态: ${isCollapsed ? '已收起' : '已展开'}`);
                
                if (isCollapsed) {
                    // 展开
                    debugLog('执行展开操作...');
                    searchRows.forEach((row, index) => {
                        row.classList.remove('hidden');
                        debugLog(`展开第 ${index + 1} 行`);
                    });
                    toggleText.textContent = '收起';
                    toggleIcon.textContent = '▲';
                    debugLog('展开完成，按钮文本改为"收起"');
                } else {
                    // 收起
                    debugLog('执行收起操作...');
                    searchRows.forEach((row, index) => {
                        row.classList.add('hidden');
                        debugLog(`隐藏第 ${index + 1} 行`);
                    });
                    toggleText.textContent = '展开';
                    toggleIcon.textContent = '▼';
                    debugLog('收起完成，按钮文本改为"展开"');
                }
                
                debugLog('toggleSearchForm 函数执行完成');
                
            } catch (error) {
                debugLog(`错误: ${error.message}`);
                console.error('toggleSearchForm 错误:', error);
            }
        }
        
        // 页面加载完成后绑定事件
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('页面加载完成，开始绑定事件...');
            
            const toggleBtn = document.getElementById('search-toggle');
            if (toggleBtn) {
                debugLog('找到折叠按钮，绑定点击事件');
                toggleBtn.addEventListener('click', function(event) {
                    debugLog('按钮被点击');
                    event.preventDefault();
                    toggleSearchForm();
                });
                debugLog('事件绑定完成');
            } else {
                debugLog('错误: 没有找到折叠按钮');
            }
        });
    </script>
</body>
</html>