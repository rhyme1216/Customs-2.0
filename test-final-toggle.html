<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>折叠功能最终测试</title>
    <link rel="stylesheet" href="customs-product-management.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        
        .test-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .test-info h3 {
            margin-top: 0;
            color: #0066cc;
        }
        
        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .debug-panel h4 {
            margin-top: 0;
        }
        
        .debug-output {
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .debug-output div {
            margin-bottom: 2px;
            padding: 2px 0;
        }
        
        .debug-output .error {
            color: #dc3545;
        }
        
        .debug-output .success {
            color: #28a745;
        }
        
        .debug-output .info {
            color: #17a2b8;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-info">
            <h3>🔧 折叠功能最终测试</h3>
            <p><strong>修复内容：</strong></p>
            <ul>
                <li>✅ 移除了HTML中的重复onclick事件绑定</li>
                <li>✅ 添加了缺失的initMultiSelectComponents()函数</li>
                <li>✅ 修复了toggleSearchForm()函数的逻辑错误</li>
                <li>✅ 验证了JavaScript语法正确性</li>
            </ul>
            <p><strong>测试步骤：</strong></p>
            <ol>
                <li>点击"收起"按钮，查询条件应该隐藏，按钮文本变为"展开"</li>
                <li>点击"展开"按钮，查询条件应该显示，按钮文本变为"收起"</li>
                <li>观察调试面板中的执行日志</li>
            </ol>
        </div>

        <!-- 模拟查询表单 -->
        <div class="search-form">
            <div class="search-header">
                <div class="search-actions">
                    <a href="javascript:void(0)" class="toggle-link" id="search-toggle">
                        <span id="toggle-text">收起</span>
                        <span id="toggle-icon">▲</span>
                    </a>
                </div>
            </div>
            
            <div class="search-row">
                <div class="form-group">
                    <label>商品名称</label>
                    <input type="text" placeholder="请输入商品名称">
                </div>
                <div class="form-group">
                    <label>商品编码</label>
                    <input type="text" placeholder="请输入商品编码">
                </div>
                <div class="form-group">
                    <label>品牌</label>
                    <input type="text" placeholder="请输入品牌">
                </div>
            </div>
            
            <div class="search-row">
                <div class="form-group">
                    <label>型号</label>
                    <input type="text" placeholder="请输入型号">
                </div>
                <div class="form-group">
                    <label>创建人</label>
                    <input type="text" placeholder="请输入创建人">
                </div>
                <div class="form-group">
                    <label>创建时间</label>
                    <input type="date">
                </div>
            </div>
            
            <div class="search-row">
                <div class="form-group">
                    <label>状态</label>
                    <select>
                        <option>全部</option>
                        <option>待处理</option>
                        <option>已完成</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>优先级</label>
                    <select>
                        <option>全部</option>
                        <option>高</option>
                        <option>中</option>
                        <option>低</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary">查询</button>
                    <button class="btn btn-secondary">重置</button>
                </div>
            </div>
        </div>

        <div class="debug-panel">
            <h4>🐛 调试输出</h4>
            <div id="debug-output" class="debug-output">
                <div class="info">[初始化] 页面加载完成，等待用户操作...</div>
            </div>
        </div>
    </div>

    <script>
        // 调试输出函数
        function debugLog(message, type = 'info') {
            const output = document.getElementById('debug-output');
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${time}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // 折叠/展开查询表单 - 使用修复后的逻辑
        function toggleSearchForm() {
            debugLog('toggleSearchForm 函数被调用', 'info');
            
            try {
                const searchRows = document.querySelectorAll('.search-row');
                const toggleText = document.getElementById('toggle-text');
                const toggleIcon = document.getElementById('toggle-icon');
                
                debugLog(`找到 ${searchRows.length} 个查询行`, 'info');
                debugLog(`当前按钮文本: "${toggleText ? toggleText.textContent : 'null'}"`, 'info');
                
                if (!searchRows.length) {
                    debugLog('错误: 没有找到查询行元素', 'error');
                    return;
                }
                
                if (!toggleText || !toggleIcon) {
                    debugLog('错误: 没有找到按钮文本或图标元素', 'error');
                    return;
                }
                
                // 检查当前状态
                const isCollapsed = searchRows[0].classList.contains('hidden');
                debugLog(`当前状态: ${isCollapsed ? '已收起' : '已展开'}`, 'info');
                
                if (isCollapsed) {
                    // 展开
                    debugLog('执行展开操作...', 'success');
                    searchRows.forEach((row, index) => {
                        row.classList.remove('hidden');
                        debugLog(`展开第 ${index + 1} 行`, 'success');
                    });
                    toggleText.textContent = '收起';
                    toggleIcon.textContent = '▲';
                    debugLog('展开完成，按钮文本改为"收起"', 'success');
                } else {
                    // 收起
                    debugLog('执行收起操作...', 'success');
                    searchRows.forEach((row, index) => {
                        row.classList.add('hidden');
                        debugLog(`隐藏第 ${index + 1} 行`, 'success');
                    });
                    toggleText.textContent = '展开';
                    toggleIcon.textContent = '▼';
                    debugLog('收起完成，按钮文本改为"展开"', 'success');
                }
                
                debugLog('toggleSearchForm 函数执行完成', 'success');
                
            } catch (error) {
                debugLog(`错误: ${error.message}`, 'error');
                console.error('toggleSearchForm 错误:', error);
            }
        }
        
        // 页面加载完成后绑定事件
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('页面DOM加载完成，开始绑定事件...', 'info');
            
            const toggleBtn = document.getElementById('search-toggle');
            if (toggleBtn) {
                debugLog('找到折叠按钮，绑定点击事件', 'success');
                toggleBtn.addEventListener('click', function(event) {
                    debugLog('按钮被点击', 'info');
                    event.preventDefault();
                    toggleSearchForm();
                });
                debugLog('事件绑定完成', 'success');
            } else {
                debugLog('错误: 没有找到折叠按钮', 'error');
            }
            
            debugLog('初始化完成，折叠功能已就绪', 'success');
        });
    </script>
</body>
</html>